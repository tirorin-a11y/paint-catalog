<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ã‚¿ãƒ­ã‚°æ¤œç´¢ - è·äººã‚®ã‚¢</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- å…±é€šãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Yu Gothic", sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; color: #333; -webkit-font-smoothing: antialiased; padding-bottom: 80px; }
        header { background-color: #2c3e50; color: white; padding: 10px 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.1rem; letter-spacing: 0.05em; font-weight: bold; }
        
        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ */
        .dashboard-nav { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; padding: 10px 15px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 50px; z-index: 90; }
        .dash-btn { background: #f8f9fa; color: #555; border: 1px solid #ddd; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; text-decoration: none; flex: 1; text-align: center; white-space: nowrap; }
        
        .search-area { padding: 15px; }
        .search-input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; box-sizing: border-box; outline: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .container { max-width: 600px; margin: 0 auto; padding: 0 15px; }
        .loading-msg { text-align: center; padding: 20px; color: #666; font-size: 0.9rem; }

        /* ã‚«ã‚¿ãƒ­ã‚°ã‚«ãƒ¼ãƒ‰ */
        .catalog-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); display: flex; flex-direction: column; gap: 5px; border-left: 5px solid #bdc3c7; }
        .maker-nippon { border-left-color: #e74c3c; } 
        .maker-sk { border-left-color: #f39c12; } 
        .maker-kansai { border-left-color: #3498db; }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .maker-badge { font-size: 0.7rem; color: white; background: #95a5a6; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .maker-nippon .maker-badge { background: #e74c3c; }
        .maker-sk .maker-badge { background: #f39c12; }
        .maker-kansai .maker-badge { background: #3498db; }

        .product-name { font-size: 1.1rem; font-weight: bold; color: #2c3e50; margin: 5px 0; }
        .product-desc { font-size: 0.85rem; color: #666; line-height: 1.5; }
        .product-tags { margin-top: 8px; display: flex; gap: 5px; flex-wrap: wrap; }
        .tag { font-size: 0.7rem; background: #f0f2f5; color: #555; padding: 3px 8px; border-radius: 10px; border: 1px solid #eee; }
        
        .card-links { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #eee; display: flex; justify-content: flex-end; gap: 10px; }
        .link-btn { text-decoration: none; font-size: 0.8rem; color: #2980b9; font-weight: bold; display: flex; align-items: center; gap: 3px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ” ã‚«ã‚¿ãƒ­ã‚°æ¤œç´¢</h1>
    <a href="navi.html" style="color:white; text-decoration:none; font-size:1.5rem;">ğŸ </a>
</header>

<div class="dashboard-nav">
    <a href="navi.html" class="dash-btn" style="border-bottom: 3px solid #27ae60; color: #27ae60;">ğŸ  ç¾å ´ãƒŠãƒ“</a>
    <a href="index.html" class="dash-btn" style="background:#e67e22; color:white; border:none;">ğŸ” æ¤œç´¢</a>
    <a href="manager.html" class="dash-btn" style="border-bottom: 3px solid #2980b9; color: #2980b9;">ğŸ“Š å·¥ç¨‹ç®¡ç†</a>
</div>

<div class="search-area">
    <input type="search" id="searchInput" class="search-input" placeholder="å•†å“å ãƒ¡ãƒ¼ã‚«ãƒ¼ ç”¨é€” (ã‚¹ãƒšãƒ¼ã‚¹ã§çµã‚Šè¾¼ã¿)" oninput="filterList()">
</div>

<div class="container" id="catalogList">
    <div class="loading-msg">ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
</div>

<script>
    // â˜…é‡è¦ï¼šã“ã“ã«ã‚«ã‚¿ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨ã®GAS URLã‚’å…¥ã‚Œã¦ãã ã•ã„
    // â€»ä»¥å‰ä½œæˆã—ãŸã€Œã‚«ã‚¿ãƒ­ã‚°æ¤œç´¢ç”¨ã€ã®GASã§ã™ï¼ˆæ—¥å ±ç”¨ã¨ã¯åˆ¥ã®URLã®ã¯ãšã§ã™ï¼‰
    // ã‚‚ã—URLãŒã‚ã‹ã‚‰ãªã‘ã‚Œã°ã€localStorageã‹ã‚‰èª­ã¿è¾¼ã‚€ãªã©èª¿æ•´ã—ã¾ã™
    const CATALOG_GAS_URL = "https://script.google.com/macros/s/AKfycbxxDC7Ak1PVF1sWYmDJlnLDokqndsNugtp1koaZgWZg51ihzksYe9hKJ4y_sTqVjUfp/exec"; // â†ã“ã“ã‚’æ­£ã—ã„URLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼

    let catalogData = [];

    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function fetchData() {
        try {
            // URLãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚µãƒ³ãƒ—ãƒ«ã‚’è¡¨ç¤ºï¼ˆã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
            if(CATALOG_GAS_URL.includes("...")) {
                console.warn("GAS URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚µãƒ³ãƒ—ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚");
                catalogData = [
                    { name: "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒˆãƒƒãƒ—", maker: "æ—¥æœ¬ãƒšã‚¤ãƒ³ãƒˆ", desc: "ãƒ©ã‚¸ã‚«ãƒ«åˆ¶å¾¡å½¢ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰é«˜è€å€™æ€§å¡—æ–™", type: "nippon", tags: "å¤–å£ æ°´æ€§", url: "" },
                    { name: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚·ãƒªã‚³ãƒ³", maker: "SKåŒ–ç ”", desc: "ã‚·ãƒªã‚³ãƒ³æ¨¹è„‚", type: "sk", tags: "å¤–å£ æ°´æ€§", url: "" }
                ];
                renderList();
                return;
            }

            const res = await fetch(CATALOG_GAS_URL);
            const data = await res.json();
            
            // ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ï¼‰
            // ä¾‹: [å•†å“å, ãƒ¡ãƒ¼ã‚«ãƒ¼, èª¬æ˜, ã‚¿ã‚¤ãƒ—, ã‚¿ã‚°, URL] ã®é †ã¨ä»®å®š
            catalogData = data.map(row => ({
                name: row.name || row[0],
                maker: row.maker || row[1],
                desc: row.desc || row[2],
                type: row.type || row[3] || 'common', // nippon, sk, kansai ç­‰
                tags: row.tags || row[4] || '',
                url: row.url || row[5] || ''
            }));
            
            renderList();
        } catch (e) {
            document.getElementById('catalogList').innerHTML = '<div class="loading-msg">âš ï¸ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼<br>ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>';
            console.error(e);
        }
    }

    function renderList() {
        const listEl = document.getElementById('catalogList');
        const inputVal = document.getElementById('searchInput').value.toLowerCase();
        
        // ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆã‚¢ãƒã‚¦ãƒˆæ¤œç´¢ç”¨ï¼‰
        const keywords = inputVal.split(/\s+/).filter(k => k !== "");
        
        listEl.innerHTML = '';
        let count = 0;

        catalogData.forEach(item => {
            // æ¤œç´¢å¯¾è±¡ã®æ–‡å­—åˆ—çµåˆ
            const targetText = `${item.name} ${item.maker} ${item.desc} ${item.tags}`.toLowerCase();
            
            // å…¨ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ (ANDæ¤œç´¢)
            const isMatch = keywords.every(kw => targetText.includes(kw));
            if (!isMatch) return;

            // ã‚¿ã‚°ã®HTMLç”Ÿæˆ
            const tagArray = item.tags.split ? item.tags.split(' ') : [];
            const tagsHtml = tagArray.map(t => `<span class="tag">#${t}</span>`).join('');
            
            // è‰²åˆ†ã‘ã‚¯ãƒ©ã‚¹
            let makerClass = "";
            if(item.maker.includes("æ—¥æœ¬")) makerClass = "maker-nippon";
            if(item.maker.includes("SK") || item.maker.includes("ã‚¨ã‚¹ã‚±ãƒ¼")) makerClass = "maker-sk";
            if(item.maker.includes("é–¢è¥¿")) makerClass = "maker-kansai";

            const html = `
                <div class="catalog-card ${makerClass}">
                    <div class="card-header">
                        <span class="maker-badge">${item.maker}</span>
                    </div>
                    <div class="product-name">${item.name}</div>
                    <div class="product-desc">${item.desc}</div>
                    <div class="product-tags">${tagsHtml}</div>
                    <div class="card-links">
                        <a href="https://www.google.com/search?q=${encodeURIComponent(item.maker + ' ' + item.name + ' SDS')}" target="_blank" class="link-btn">ğŸ“„ SDSæ¤œç´¢</a>
                        ${item.url ? `<a href="${item.url}" target="_blank" class="link-btn">ğŸŒ å…¬å¼ã‚µã‚¤ãƒˆ</a>` : ''}
                    </div>
                </div>
            `;
            listEl.insertAdjacentHTML('beforeend', html);
            count++;
        });

        if(count === 0) {
            listEl.innerHTML = '<div class="loading-msg">è©²å½“ãªã—</div>';
        }
    }

    function filterList() {
        renderList();
    }

    document.addEventListener('DOMContentLoaded', fetchData);
</script>

</body>
</html>