<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è·äººã‚®ã‚¢ V16 (ã‚¹ãƒãƒ›å®Œå…¨å¯¾å¿œ)</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
    * { box-sizing: border-box; touch-action: manipulation; /* ã‚¿ãƒƒãƒæ“ä½œã®é…å»¶ã‚’ãªãã™ */ }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
        background-color: #2c3e50;
        color: #333;
        margin: 0; 
        /* â˜…ä¿®æ­£ï¼šã‚¹ãƒãƒ›ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å¯¾ç­– (100dvh) ã¨ä½™ç™½å‰Šæ¸› */
        height: 100dvh; 
        padding: 5px; 
        display: flex; flex-direction: column;
        overflow: hidden;
    }

    /* UIå…±é€š */
    button {
        border: none; padding: 8px 10px; border-radius: 6px; cursor: pointer;
        font-size: 12px; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center;
        transition: opacity 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    button:active { opacity: 0.7; transform: scale(0.96); }
    
    .btn-home { background: #555; }
    .btn-data { background: #8e44ad; }
    .btn-add  { background: #2ecc71; }
    .btn-reset{ background: #e74c3c; } 
    .btn-photo{ background: #e67e22; }
    .btn-save { background: #34495e; }
    .btn-sub  { background: #95a5a6; font-size: 11px; padding: 5px 10px; width:100%; margin-top:10px;}

    /* æ“ä½œãƒ‘ãƒãƒ«ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–ï¼‰ */
    .control-panel {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px; border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        display: flex; gap: 5px; justify-content: space-between; align-items: center;
        margin-bottom: 5px; flex-shrink: 0; z-index: 100;
        overflow-x: auto; /* ãƒœã‚¿ãƒ³ãŒå¤šã„æ™‚ã¯æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        white-space: nowrap;
    }
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éš ã™ */
    .control-panel::-webkit-scrollbar { display: none; }

    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    .workspace { 
        display: flex; flex: 1; gap: 5px; overflow: hidden; position: relative;
        background-size: cover; background-position: center; background-repeat: no-repeat;
        background-color: #bdc3c7; 
        border-radius: 8px;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
    }
    
    .palette, .scale-area {
        background: rgba(255, 255, 255, 0.15); /* å°‘ã—æ˜ã‚‹ã */
        border: 1px solid rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(4px);
    }

    /* å·¦ï¼šã‚«ã‚¿ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
    .palette {
        width: 120px; border-radius: 8px;
        padding: 5px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px;
    }
    .palette-item-wrap { position: relative; width: 100%; display: flex; justify-content: center; }
    
    .palette-del-btn {
        position: absolute; top: -6px; left: -4px; width: 22px; height: 22px; 
        background: #e74c3c; color: white; border: 2px solid #fff;
        border-radius: 50%; font-size: 16px; line-height: 18px; text-align: center; font-weight: bold;
        cursor: pointer; z-index: 10; 
        /* ã‚¹ãƒãƒ›ã ã¨ãƒ›ãƒãƒ¼ãŒãªã„ã®ã§å¸¸ã«è¡¨ç¤ºã™ã‚‹ã‹ã€ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã„ã‚ˆã†ã«èª¿æ•´ */
        display: block; opacity: 0.8;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* å³ï¼šç©ã¿ä¸Šã’ã‚¨ãƒªã‚¢ */
    .scale-area {
        flex: 1; 
        border-bottom: 10px solid rgba(44, 62, 80, 0.8);
        border-radius: 8px 8px 0 0; position: relative;
        display: flex; justify-content: center; align-items: flex-end; overflow: hidden;
    }
    #stack-container {
        width: 100%; display: flex; flex-direction: column-reverse;
        align-items: center; transition: transform 0.1s; transform-origin: bottom center; padding-bottom: 2px;
    }

    /* åˆè¨ˆè¡¨ç¤º */
    .total-display {
        position: absolute; top: 10px; right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #f1c40f; padding: 6px 12px;
        border-radius: 20px; font-size: 16px; font-weight: bold; z-index: 100; pointer-events: none;
        backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.3);
        text-align: right;
    }
    .tax-info { font-size: 9px; color: #ddd; font-weight: normal; display: block;}

    /* ç®±ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .cost-box {
        width: 90%; max-width: 280px; border-radius: 4px;
        display: flex; justify-content: space-between; align-items: center; padding: 0 6px;
        color: white; font-weight: bold; cursor: grab; font-size: 10px;
        position: relative; line-height: 1.2; flex-shrink: 0;
        opacity: 0.9; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        border: 1px solid rgba(255,255,255,0.4);
        text-shadow: 0 1px 2px rgba(0,0,0, 0.8); 
    }

    .palette .cost-box { 
        height: 38px !important; font-size: 10px; width: 100%; margin: 0;
        justify-content: flex-end; padding-left: 20px; padding-right: 5px; text-align: right;
    }

    /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚´ãƒ¼ã‚¹ãƒˆè¦ç´ ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .dragging-ghost {
        position: fixed; pointer-events: none; z-index: 9999;
        opacity: 0.8; transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«é¡ */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 999; backdrop-filter: blur(3px); }
    .modal-content { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 350px; display: flex; flex-direction: column; gap: 10px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .form-group label { display: block; font-size: 11px; color: #555; margin-bottom: 3px; }
    .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    #site-data-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    
    .color-palette { display: flex; justify-content: space-between; gap: 5px; margin-top: 5px; }
    .color-swatch { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .color-swatch.selected { border-color: #333; transform: scale(1.1); }

</style>
</head>
<body>

    <div class="control-panel">
        <div style="display:flex; gap:5px;">
            <button class="btn-home" onclick="location.href='index.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
            <button class="btn-data" onclick="openDataModal()">âš™ï¸ è¨­å®š</button>
            <button class="btn-photo" onclick="document.getElementById('bg-upload').click()">ğŸ“· èƒŒæ™¯</button>
            <input type="file" id="bg-upload" accept="image/*" style="display:none" onchange="loadBackground(this)">
        </div>

        <div style="display:flex; gap:5px; align-items:center;">
            <input type="range" id="zoom" min="0.2" max="1.5" step="0.1" value="1.0" style="width:60px;">
            <button class="btn-add" onclick="openItemModal()">ï¼‹ éƒ¨æ</button>
            <button class="btn-reset" onclick="resetStack()">ğŸ—‘ï¸</button>
            <button class="btn-save" onclick="saveAsImage()">ğŸ’¾ ä¿å­˜</button>
        </div>
    </div>

    <div class="workspace" id="capture-area">
        <div class="palette" id="source-zone"></div>
        <div class="scale-area" id="drop-zone">
            <div class="total-display">
                <span class="tax-info">ç¨è¾¼åˆè¨ˆ</span>
                Â¥<span id="total-price">0</span>
            </div>
            <div id="stack-container"></div>
            <div style="position:absolute; bottom:5px; color:rgba(255,255,255,0.7); font-size:10px; text-shadow:0 1px 2px rgba(0,0,0,0.8);">ã‚¿ãƒƒãƒ—ã§å‰Šé™¤</div>
        </div>
    </div>

    <div id="dataModal" class="modal">
        <div class="modal-content">
            <h3>å»ºç‰©ãƒ‡ãƒ¼ã‚¿ (è¨ˆç®—åŸºæº–)</h3>
            <div id="site-data-list"></div>
            <button class="btn-sub" onclick="addNewVariable()">ï¼‹ æ–°ã—ã„åŸºæº–ã‚’è¿½åŠ </button>
            <button onclick="saveDataModal()" style="background:#3498db; width:100%; margin-top:10px;">é–‰ã˜ã‚‹ & ä¿å­˜</button>
        </div>
    </div>

    <div id="itemModal" class="modal">
        <div class="modal-content">
            <h3>éƒ¨æã‚«ã‚¿ãƒ­ã‚°è¿½åŠ </h3>
            <div class="form-group">
                <label>é …ç›®å</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="m-name" placeholder="åç§°ã‚’å…¥åŠ›" style="flex:1;">
                    <select id="m-name-preset" onchange="applyPresetName()" style="width:90px; font-size:11px;"><option value="">å€™è£œã‹ã‚‰</option></select>
                </div>
            </div>
            <div class="form-group"><label>è¨ˆç®—ã‚¿ã‚¤ãƒ—</label><select id="m-type"></select></div>
            <div class="form-group"><label>é‡‘é¡ / å˜ä¾¡</label><input type="number" id="m-price"></div>
            <div class="form-group"><label>è‰²ã‚’é¸æŠ</label><div class="color-palette" id="swatch-container"></div><input type="hidden" id="m-color-val" value="#95a5a6"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="closeItemModal()" style="background:#ccc; flex:1; color:#333;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="addItemFromModal()" style="background:#2ecc71; flex:1;">è¿½åŠ </button>
            </div>
        </div>
    </div>

<script>
    const PIXEL_PER_YEN = 0.0005; 
    const STORAGE_KEY_VARS = 'shokunin_vars_v9';
    const STORAGE_KEY_ITEMS = 'shokunin_items_v9';
    const TAX_RATE = 1.1; 

    const PRESET_COLORS = [
        { val: '#95a5a6', name: 'ã‚°ãƒ¬ãƒ¼' }, { val: '#e74c3c', name: 'èµ¤' },
        { val: '#3498db', name: 'é’' }, { val: '#f1c40f', name: 'é»„' }, { val: '#2ecc71', name: 'ç·‘' }
    ];

    let siteVariables = [], paletteItems = [];
    const sourceZone = document.getElementById('source-zone');
    const stackContainer = document.getElementById('stack-container');
    const dropZone = document.getElementById('drop-zone');
    const totalDisplay = document.getElementById('total-price');

    loadData(); renderPalette(); initColorSwatches();

    document.getElementById('zoom').addEventListener('input', (e) => stackContainer.style.transform = `scale(${e.target.value})`);

    function loadBackground(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('capture-area').style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function saveAsImage() {
        const element = document.getElementById('capture-area');
        html2canvas(element, { backgroundColor: null }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'mitsumori_sim.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function initColorSwatches() {
        const container = document.getElementById('swatch-container');
        const input = document.getElementById('m-color-val');
        container.innerHTML = '';
        PRESET_COLORS.forEach((color, index) => {
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.style.backgroundColor = color.val;
            swatch.onclick = () => {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
                swatch.classList.add('selected');
                input.value = color.val;
            };
            if (index === 0) swatch.classList.add('selected');
            container.appendChild(swatch);
        });
    }

    function loadData() {
        const savedVars = localStorage.getItem(STORAGE_KEY_VARS);
        siteVariables = savedVars ? JSON.parse(savedVars) : [{ id: 'wall', label: 'å¤–å£(ã¡)', val: 150 }, { id: 'roof', label: 'å±‹æ ¹(ã¡)', val: 80 }, { id: 'seal', label: 'ã‚·ãƒ¼ãƒ«(ï½)', val: 120 }];
        const savedItems = localStorage.getItem(STORAGE_KEY_ITEMS);
        paletteItems = savedItems ? JSON.parse(savedItems) : [
            { id: 1, label: "è¶³å ´ä»£", unitPrice: 150000, typeId: "fixed", color: "#95a5a6" },
            { id: 2, label: "å¤–å£ã‚·ãƒªã‚³ãƒ³", unitPrice: 2800, typeId: "wall", color: "#e74c3c" },
            { id: 3, label: "å±‹æ ¹ãƒ•ãƒƒç´ ", unitPrice: 4500, typeId: "roof", color: "#3498db" }
        ];
    }
    function saveData() { localStorage.setItem(STORAGE_KEY_VARS, JSON.stringify(siteVariables)); localStorage.setItem(STORAGE_KEY_ITEMS, JSON.stringify(paletteItems)); }

    function renderPalette() {
        sourceZone.innerHTML = '';
        paletteItems.forEach((item, index) => {
            const wrap = document.createElement('div'); wrap.className = 'palette-item-wrap';
            
            const delBtn = document.createElement('div'); 
            delBtn.className = 'palette-del-btn'; 
            delBtn.innerHTML = 'Ã—';
            delBtn.onclick = () => deletePaletteItem(index);

            const div = document.createElement('div'); 
            div.className = 'cost-box'; 
            
            div.style.background = `linear-gradient(135deg, ${item.color}, ${darkenColor(item.color, 20)})`;
            div.innerHTML = `<span>${item.label}</span>`;
            
            // â˜…ã‚¹ãƒãƒ›å¯¾å¿œï¼šã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            setupTouchDrag(div, item);

            // PCç”¨ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå¿µã®ãŸã‚æ®‹ã™ï¼‰
            div.draggable = true;
            div.addEventListener('dragstart', (e) => { e.dataTransfer.effectAllowed = 'copy'; e.dataTransfer.setData('application/json', JSON.stringify(item)); div.style.opacity = '0.5'; });
            div.addEventListener('dragend', () => div.style.opacity = '0.9');
            
            wrap.appendChild(div); wrap.appendChild(delBtn); sourceZone.appendChild(wrap);
        });
    }

    // â˜…â˜…â˜… ã‚¹ãƒãƒ›ç”¨ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè£…ã®æ ¸å¿ƒéƒ¨åˆ† â˜…â˜…â˜…
    function setupTouchDrag(el, itemData) {
        let ghost = null;
        let startX, startY;

        el.addEventListener('touchstart', (e) => {
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æ­¢ã‚ã‚‹
            // e.preventDefault(); // ã“ã‚Œã‚’å…¥ã‚Œã‚‹ã¨ã‚«ã‚¿ãƒ­ã‚°ã®ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒã§ããªããªã‚‹ã®ã§æ³¨æ„ã€‚
            // æ¨ªæ–¹å‘ã®ç§»å‹•ãŒå¤§ãã‘ã‚Œã°ãƒ‰ãƒ©ãƒƒã‚°ã¨ã¿ãªã™ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã ãŒã€ä»Šå›ã¯é•·æŠ¼ã—åˆ¤å®šãªã©ã¯ã›ãšã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè£…
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;

            // è¤‡è£½ï¼ˆã‚´ãƒ¼ã‚¹ãƒˆï¼‰ã‚’ä½œæˆ
            ghost = el.cloneNode(true);
            ghost.classList.add('dragging-ghost');
            ghost.style.width = el.offsetWidth + 'px';
            ghost.style.height = el.offsetHeight + 'px';
            ghost.style.left = (touch.clientX - el.offsetWidth/2) + 'px';
            ghost.style.top = (touch.clientY - el.offsetHeight/2) + 'px';
            
            document.body.appendChild(ghost);
        }, {passive: false});

        el.addEventListener('touchmove', (e) => {
            if (!ghost) return;
            e.preventDefault(); // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯ç”»é¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢
            const touch = e.touches[0];
            ghost.style.left = (touch.clientX - ghost.offsetWidth/2) + 'px';
            ghost.style.top = (touch.clientY - ghost.offsetHeight/2) + 'px';
        }, {passive: false});

        el.addEventListener('touchend', (e) => {
            if (!ghost) return;
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã®åˆ¤å®š
            const touch = e.changedTouches[0];
            const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
            
            // ãƒ‰ãƒ­ãƒƒãƒ—å…ˆãŒã€Œscale-areaã€ã¾ãŸã¯ãã®å­è¦ç´ ãªã‚‰OK
            if (dropTarget && dropTarget.closest('#drop-zone')) {
                createStackBox(itemData);
            }

            // ã‚´ãƒ¼ã‚¹ãƒˆæ¶ˆå»
            document.body.removeChild(ghost);
            ghost = null;
        });
    }

    function addPaletteItem(label, unitPrice, typeId, color) { paletteItems.push({ id: Date.now(), label, unitPrice, typeId, color }); saveData(); renderPalette(); }
    function deletePaletteItem(index) { if(confirm("ã‚«ã‚¿ãƒ­ã‚°ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { paletteItems.splice(index, 1); saveData(); renderPalette(); } }

    // PCç”¨ãƒ‰ãƒ­ãƒƒãƒ—å—ã‘å…¥ã‚Œï¼ˆå¿µã®ãŸã‚ï¼‰
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; });
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); const data = JSON.parse(e.dataTransfer.getData('application/json')||'null'); if(data) createStackBox(data); });

    function createStackBox(data) {
        const div = document.createElement('div'); div.className = 'cost-box';
        div.style.background = `linear-gradient(135deg, ${data.color}, ${darkenColor(data.color, 20)})`;
        div.dataset.label = data.label; div.dataset.unitPrice = data.unitPrice; div.dataset.typeId = data.typeId; 
        div.addEventListener('click', () => { if(confirm('å´©ã—ã¾ã™ã‹ï¼Ÿ')) { div.remove(); recalcTotal(); } });
        stackContainer.appendChild(div); recalcSingleBox(div); recalcTotal();
    }

    function recalcSingleBox(box) {
        const typeId = box.dataset.typeId; const unitPrice = parseFloat(box.dataset.unitPrice);
        let multiplier = 1; 
        if (typeId !== 'fixed') { const variable = siteVariables.find(v => v.id === typeId); multiplier = variable ? parseFloat(variable.val) : 0; }
        const currentPrice = unitPrice * multiplier;
        box.dataset.currentPrice = currentPrice;
        let height = currentPrice * PIXEL_PER_YEN; if (height < 24) height = 24; box.style.height = `${height}px`;
        box.innerHTML = `<span>${box.dataset.label}</span><span>Â¥${Math.round(currentPrice).toLocaleString()}</span>`;
    }

    function recalcTotal() {
        let total = 0; const boxes = stackContainer.querySelectorAll('.cost-box');
        boxes.forEach(box => { recalcSingleBox(box); total += parseFloat(box.dataset.currentPrice); });
        const totalTaxIn = Math.round(total * TAX_RATE);
        totalDisplay.innerText = totalTaxIn.toLocaleString();
    }

    function openDataModal() {
        const list = document.getElementById('site-data-list'); list.innerHTML = '';
        siteVariables.forEach(v => {
            const div = document.createElement('div');
            div.innerHTML = `<div class="form-group"><label>${v.label}</label><input type="number" value="${v.val}" onchange="updateVariable('${v.id}', this.value)"></div>`;
            list.appendChild(div);
        });
        document.getElementById('dataModal').style.display = 'flex';
    }
    window.updateVariable = function(id, val) { const target = siteVariables.find(v => v.id === id); if (target) target.val = parseFloat(val); }
    window.addNewVariable = function() { const name = prompt("é …ç›®å"); if (!name) return; siteVariables.push({ id: 'custom_' + Date.now(), label: name, val: 0 }); openDataModal(); }
    function saveDataModal() { document.getElementById('dataModal').style.display = 'none'; saveData(); recalcTotal(); }

    function openItemModal() {
        const selectType = document.getElementById('m-type'); selectType.innerHTML = '<option value="fixed">å›ºå®šé‡‘é¡ (ä¸€å¼)</option>';
        const selectName = document.getElementById('m-name-preset'); selectName.innerHTML = '<option value="">å€™è£œã‹ã‚‰</option>';
        siteVariables.forEach(v => {
            const optType = document.createElement('option'); optType.value = v.id; optType.text = `Ã— ${v.label}`; selectType.appendChild(optType);
            const optName = document.createElement('option'); optName.value = v.label; optName.text = v.label; selectName.appendChild(optName);
        });
        document.getElementById('itemModal').style.display = 'flex';
    }
    window.applyPresetName = function() { const val = document.getElementById('m-name-preset').value; if (val) document.getElementById('m-name').value = val; }
    function closeItemModal() { document.getElementById('itemModal').style.display = 'none'; }
    function addItemFromModal() {
        const name = document.getElementById('m-name').value, type = document.getElementById('m-type').value, price = parseFloat(document.getElementById('m-price').value), color = document.getElementById('m-color-val').value;
        if (name && price) { addPaletteItem(name, price, type, color); closeItemModal(); }
    }
    function resetStack() { if(confirm("ç©ã¿ä¸Šã’ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) { stackContainer.innerHTML = ''; recalcTotal(); } }
    function darkenColor(hex, percent) { let num = parseInt(hex.replace("#",""), 16), amt = Math.round(2.55 * percent), R = (num >> 16) - amt, B = (num >> 8 & 0x00FF) - amt, G = (num & 0x0000FF) - amt; return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (B<255?B<1?0:B:255)*0x100 + (G<255?G<1?0:G:255)).toString(16).slice(1); }
</script>
</body>
</html>