<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ˜ãƒ«ãƒ—ï¼†è¨­å®š - è·äººã‚®ã‚¢</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Yu Gothic", sans-serif; background: #f0f2f5; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; padding-bottom: 50px; }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 1.5rem; }
        .back-link { display: block; margin-bottom: 20px; color: #2980b9; text-decoration: none; font-weight: bold; }

        /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        details {
            background: white;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        summary {
            padding: 15px 20px;
            font-weight: bold;
            cursor: pointer;
            background: #fff;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '+'; font-size: 1.5rem; color: #aaa; }
        details[open] summary { border-bottom: 1px solid #eee; background: #f9f9f9; }
        details[open] summary::after { content: '-'; }
        
        .content { padding: 20px; }
        
        /* ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .code-area {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 13px;
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
            white-space: pre;
            overflow: auto;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .btn-copy {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            width: 100%;
            justify-content: center;
        }
        .btn-copy:active { transform: translateY(2px); }
        
        h3 { border-left: 4px solid #3498db; padding-left: 10px; margin-top: 25px; color: #34495e; }
        h3:first-of-type { margin-top: 0; }
        ul, ol { padding-left: 20px; }
        li { margin-bottom: 8px; }
    </style>
</head>
<body>

<div class="container">
    <a href="navi.html" class="back-link">â† ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
    <h1>ğŸ“– ãƒ˜ãƒ«ãƒ—ï¼†è¨­å®šã‚¬ã‚¤ãƒ‰</h1>

    <details open>
        <summary>ğŸ“± ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹ãƒ»ãƒ‡ãƒ¼ã‚¿ä¿å­˜</summary>
        <div class="content">
            <h3>åŸºæœ¬æ“ä½œ</h3>
            <ul>
                <li><strong>ç¾å ´ã®ç™»éŒ²:</strong> å³ä¸‹ã®ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æ–°è¦ç™»éŒ²ã§ãã¾ã™ã€‚</li>
                <li><strong>ãƒŠãƒ“èµ·å‹•:</strong> ãƒªã‚¹ãƒˆã®ã€ŒğŸš€ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨Googleãƒãƒƒãƒ—ãŒèµ·å‹•ã—ã€åŒæ™‚ã«ãƒŠãƒ“å›æ•°ãŒã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚</li>
                <li><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´:</strong> ãƒªã‚¹ãƒˆå·¦ä¸Šã®ãƒãƒƒã‚¸ï¼ˆè¦‹ç©ä¸­ãªã©ï¼‰ã‚’è¦‹ã‚‹ã“ã¨ã§çŠ¶æ³ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ã€‚</li>
            </ul>

            <h3>â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼ˆæ¨å¥¨ï¼‰</h3>
            <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã€PCã‚„ä»–ã®ã‚¹ãƒãƒ›ã¨ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•åŒæœŸã—ã¾ã™ã€‚</p>
            <ul>
                <li><strong>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:</strong> è¨­å®šç”»é¢ã®ã€Œâ˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ã§ä¿å­˜ã—ã¾ã™ã€‚</li>
                <li><strong>å¾©å…ƒ:</strong> ã€ŒğŸ“¥ ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å¾©å…ƒã€ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ã¾ã™ã€‚</li>
                <li>â€»PCã§ç·¨é›†ã—ãŸå†…å®¹ã‚‚ã€Œå¾©å…ƒã€ãƒœã‚¿ãƒ³ã§åæ˜ ã•ã‚Œã¾ã™ã€‚</li>
            </ul>

            <h3>ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ä¿å­˜ãƒ»å¾©å…ƒï¼ˆãƒ¡ãƒ¼ãƒ«ãªã©ï¼‰</h3>
            <p>ã‚¯ãƒ©ã‚¦ãƒ‰è¨­å®šãŒãªãã¦ã‚‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚„å…±æœ‰ãŒã§ãã¾ã™ã€‚</p>
            <ul>
                <li><strong>æ›¸ãå‡ºã—:</strong> å³ä¸‹ã®ã€Œå…±æœ‰ãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼‰ã€ã‚’æŠ¼ã—ã€ã€Œå…±æœ‰ã€ã‚’é¸ã¶ã¨ã€ãƒ¡ãƒ¼ãƒ«ã‚„LINEã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.jsonï¼‰ã‚’é€ä¿¡ãƒ»ä¿å­˜ã§ãã¾ã™ã€‚</li>
                <li><strong>å–ã‚Šè¾¼ã¿:</strong> è¨­å®šç”»é¢ï¼ˆâš™ï¸ï¼‰ã®ã€ŒğŸ“¥ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©å…ƒã€ã‚’æŠ¼ã—ã€ãƒ¡ãƒ¼ãƒ«ç­‰ã§å—ã‘å–ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨å¾©å…ƒã•ã‚Œã¾ã™ã€‚</li>
            </ul>
        </div>
    </details>

    <details>
        <summary>ğŸ“ æ—¥å ±ãƒ»ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½</summary>
        <div class="content">
            <h3>æ—¥å ±ã®é€ä¿¡</h3>
            <p>ç¾å ´ãƒªã‚¹ãƒˆã®ã€ŒğŸ§° ãƒ„ãƒ¼ãƒ«ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æ—¥å ±ç”»é¢ã¸ç§»å‹•ã§ãã¾ã™ã€‚</p>
            <ul>
                <li><strong>æ—¥å ±ä½œæˆ:</strong> ãã®æ—¥ã®ä½œæ¥­å†…å®¹ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚å±¥æ­´ã¨ã—ã¦ç«¯æœ«ã«æ®‹ã‚Šã¾ã™ã€‚</li>
                <li><strong>ã‚¯ãƒ©ã‚¦ãƒ‰æå‡º:</strong> ã€ŒğŸ“¤ ã‚¯ãƒ©ã‚¦ãƒ‰ã¸æå‡ºã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œæ—¥å ±ã€ã‚·ãƒ¼ãƒˆã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚</li>
                <li>â€»ä¸€åº¦æå‡ºã—ãŸæ—¥å ±ã‚‚ã€å±¥æ­´ã‹ã‚‰å†é€å¯èƒ½ã§ã™ã€‚</li>
            </ul>
        </div>
    </details>

    <details>
        <summary>ğŸ› ï¸ ã€åˆæœŸè¨­å®šã€‘ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã®æ§‹ç¯‰</summary>
        <div class="content">
            <p>ã“ã®ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»å…±æœ‰ã™ã‚‹ãŸã‚ã®ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€ã‚’ä½œæˆã™ã‚‹æ‰‹é †ã§ã™ã€‚<br>
            <strong>åˆã‚ã¦ä½¿ã†æ–¹</strong>ã‚„ã€<strong>ç®¡ç†è€…ã®æ–¹</strong>ã®ã¿è¡Œã£ã¦ãã ã•ã„ã€‚</p>

            <h3>STEP 1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæº–å‚™</h3>
            <ol>
                <li><a href="https://sheets.new" target="_blank">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</a> ã‚’æ–°è¦ä½œæˆã—ã¾ã™ã€‚</li>
                <li>ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã€Œè·äººã‚®ã‚¢_ãƒ‡ãƒ¼ã‚¿ã€ç­‰ã«å¤‰æ›´ã—ã¾ã™ã€‚</li>
                <li>ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€â†’ã€ŒApps Scriptã€ã‚’é–‹ãã¾ã™ã€‚</li>
            </ol>

            <h3>STEP 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆç™»éŒ²</h3>
            <p>ã‚¨ãƒ‡ã‚£ã‚¿ã®æ–‡å­—ã‚’å…¨ã¦æ¶ˆã—ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
            
            <textarea id="gasCode" class="code-area" readonly>
function doPost(e) {
  var json = JSON.parse(e.postData.contents);
  var type = json.type;
  var ss = SpreadsheetApp.getActiveSpreadsheet();

  if (type === "report") {
    var sheet = ss.getSheetByName("æ—¥å ±");
    if (!sheet) { 
      sheet = ss.insertSheet("æ—¥å ±"); 
      sheet.appendRow(["æ—¥æ™‚", "æ¡ˆä»¶No", "ç¾å ´å", "ä½æ‰€", "å ±å‘Šè€…", "å†…å®¹"]); 
      sheet.setFrozenRows(1); 
    }
    var reporter = json.reporter || "è·äºº";
    var reportDate = json.timestamp ? new Date(json.timestamp) : new Date();
    sheet.appendRow([reportDate, json.id, json.siteName, json.address, reporter, json.content]);
    return ContentService.createTextOutput(JSON.stringify({ result: "success" })).setMimeType(ContentService.MimeType.TEXT);
  }

  else if (type === "sync") {
    var sheet = ss.getSheetByName("æ¡ˆä»¶ä¸€è¦§");
    if (!sheet) { sheet = ss.insertSheet("æ¡ˆä»¶ä¸€è¦§"); }
    sheet.clear();
    var header = ["æ¡ˆä»¶No", "è¦ªæ¡ˆä»¶No", "ç¾å ´å", "ä½æ‰€", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "ãƒŠãƒ“å›æ•°", "å·¥æœŸé–‹å§‹", "å·¥æœŸçµ‚äº†", "æœ€çµ‚æ›´æ–°æ—¥æ™‚", "JSONãƒ‡ãƒ¼ã‚¿"];
    sheet.appendRow(header);
    
    var sites = json.data;
    var rows = [];
    var stMap = { 'estimate':'è¦‹ç©ä¸­', 'contract':'å¥‘ç´„æ¸ˆã¿', 'billing':'è«‹æ±‚', 'complete':'å®Œäº†', 'lost':'å¤±æ³¨' };

    for (var i = 0; i < sites.length; i++) {
      var s = sites[i];
      var stLabel = stMap[s.status] || s.status;
      rows.push([
        s.id, s.parentCaseNo||"", s.name, s.address, stLabel, 
        s.naviCount||0, s.start||"", s.end||"", 
        s.updatedAt ? new Date(s.updatedAt).toLocaleString() : "",
        JSON.stringify(s)
      ]);
    }
    if (rows.length > 0) { sheet.getRange(2, 1, rows.length, rows[0].length).setValues(rows); }
    return ContentService.createTextOutput(JSON.stringify({ result: "success", msg: "ä¿å­˜å®Œäº†" })).setMimeType(ContentService.MimeType.TEXT);
  }

  else if (type === "calendar") {
    var cal = CalendarApp.getCalendarById(json.calendarId);
    if(cal) cal.createAllDayEvent(json.title, new Date(), { location: json.address, description: "ç™»éŒ²: è·äººã‚®ã‚¢" });
    return ContentService.createTextOutput(JSON.stringify({ result: "success" })).setMimeType(ContentService.MimeType.TEXT);
  }
}

function doGet(e) {
  var type = e.parameter.type;
  var ss = SpreadsheetApp.getActiveSpreadsheet();

  if (type === "getAll") {
    var sheet = ss.getSheetByName("æ¡ˆä»¶ä¸€è¦§");
    if (!sheet) return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.TEXT);
    var rows = sheet.getDataRange().getValues();
    var data = [];
    var reverseStMap = { 'è¦‹ç©ä¸­':'estimate', 'å¥‘ç´„æ¸ˆã¿':'contract', 'è«‹æ±‚':'billing', 'å®Œäº†':'complete', 'å¤±æ³¨':'lost' };

    for (var i = 1; i < rows.length; i++) {
      var row = rows[i];
      var siteData = {
        id: String(row[0]), parentCaseNo: String(row[1]), name: String(row[2]), address: String(row[3]),
        status: reverseStMap[row[4]] || 'estimate', naviCount: Number(row[5]),
        start: row[6] ? formatYMD(row[6]) : "", end: row[7] ? formatYMD(row[7]) : "",
        updatedAt: row[8] ? new Date(row[8]).getTime() : 0
      };
      if(siteData.id) { data.push(siteData); }
    }
    return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.TEXT);
  }
  return ContentService.createTextOutput(JSON.stringify({msg:"ready"})).setMimeType(ContentService.MimeType.TEXT);
}

function formatYMD(val) {
  if (!val) return "";
  var d = new Date(val);
  if (isNaN(d.getTime())) return "";
  var y = d.getFullYear();
  var m = ("0" + (d.getMonth() + 1)).slice(-2);
  var da = ("0" + d.getDate()).slice(-2);
  return y + "-" + m + "-" + da;
}

function onEdit(e) {
  var sheet = e.source.getActiveSheet();
  if (sheet.getName() !== "æ¡ˆä»¶ä¸€è¦§") return;
  var row = e.range.getRow();
  var col = e.range.getColumn();
  if (row < 2 || col === 9) return;
  sheet.getRange(row, 9).setValue(new Date());
}
            </textarea>
            <button class="btn-copy" onclick="copyCode()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>

            <h3>STEP 3. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆé‡è¦ï¼‰</h3>
            <ul>
                <li>å³ä¸Šã®ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€</li>
                <li>ç¨®é¡ï¼šã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€</li>
                <li>ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼š<span style="color:red; font-weight:bold;">å…¨å“¡ (Anyone)</span></li>
            </ul>
            <p>ç™ºè¡Œã•ã‚ŒãŸURLã‚’ã€ã‚¢ãƒ—ãƒªã®ã€Œè¨­å®šã€â†’ã€ŒGAS URLã€ã«ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </details>

    <br>
    <a href="navi.html" class="back-link" style="text-align:center;">ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
</div>

<script>
    function copyCode() {
        var copyText = document.getElementById("gasCode");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(function() {
            alert("âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        }, function() {
            alert("ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
        });
    }
</script>

</body>
</html>