<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ˜ãƒ«ãƒ—ï¼†è¨­å®š - è·äººã‚®ã‚¢</title>
    <link rel="icon" href="icon-192x192.png">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Yu Gothic", sans-serif; background: #f0f2f5; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; padding-bottom: 50px; }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 1.5rem; }
        .back-link { display: block; margin-bottom: 20px; color: #2980b9; text-decoration: none; font-weight: bold; }

        details { background: white; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; }
        summary { padding: 15px 20px; font-weight: bold; cursor: pointer; background: #fff; list-style: none; display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; color: #2c3e50; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '+'; font-size: 1.5rem; color: #aaa; }
        details[open] summary { border-bottom: 1px solid #eee; background: #f9f9f9; }
        details[open] summary::after { content: '-'; }
        
        .content { padding: 20px; }
        
        .code-area { width: 100%; height: 200px; font-family: monospace; font-size: 13px; background: #282c34; color: #abb2bf; padding: 15px; border-radius: 6px; border: 1px solid #ccc; white-space: pre; overflow: auto; margin-bottom: 10px; box-sizing: border-box; }

        .btn-copy { background-color: #2980b9; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; display: inline-flex; align-items: center; gap: 5px; width: 100%; justify-content: center; }
        .btn-copy:active { transform: translateY(2px); }
        
        h3 { border-left: 4px solid #3498db; padding-left: 10px; margin-top: 25px; color: #34495e; }
        h3:first-of-type { margin-top: 0; }
        ul, ol { padding-left: 20px; }
        li { margin-bottom: 8px; }
        
        .alert-box { background: #fff3e0; border: 1px solid #ffe0b2; padding: 15px; border-radius: 6px; color: #e65100; font-size: 0.95rem; margin-top: 10px; }

        /* --- ä¿®æ­£ï¼šãŠå•ã„åˆã‚ã›ã‚¨ãƒªã‚¢ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã¨ãƒ‡ã‚¶ã‚¤ãƒ³çµ±ä¸€ï¼‰ --- */
        .contact-area { 
            margin-top: 30px; 
            background: white;          /* èƒŒæ™¯ã‚’ç™½ã«çµ±ä¸€ */
            border-radius: 8px;         /* è§’ä¸¸ã‚’çµ±ä¸€ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã¨åŒã˜å½± */
            overflow: hidden;           /* ã¯ã¿å‡ºã—é˜²æ­¢ */
            padding: 0;                 /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã®ä½™ç™½ã‚’ãªãã™ */
        }

        /* è¦‹å‡ºã—ã‚’ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‰ã˜ãŸçŠ¶æ…‹ã¨åŒã˜è¦‹ãŸç›®ã«ã™ã‚‹ */
        .contact-area h3 { 
            margin: 0; 
            padding: 15px 20px;         /* summaryã‚¿ã‚°ã¨åŒã˜ä½™ç™½ */
            background: #fff; 
            color: #2c3e50; 
            font-size: 1.1rem; 
            border-bottom: 1px solid #eee; /* åŒºåˆ‡ã‚Šç·š */
            text-align: left;           /* å·¦å¯„ã› */
        }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®ã€Œå†…å´ã®æ ã€ã‚’æ¶ˆã—ã¦åºƒã’ã‚‹ */
        .contact-msg { 
            font-size: 0.9rem; 
            color: #444; 
            padding: 20px 20px 0 20px;  /* å·¦å³ã®ä½™ç™½ã‚’ç¢ºä¿ */
            margin-bottom: 10px; 
            text-align: left;           /* èª­ã¿ã‚„ã™ãå·¦å¯„ã› */
            background: transparent;    /* èƒŒæ™¯è‰²ãªã— */
            border: none;               /* æ ç·šãªã— */
            border-radius: 0; 
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ å‘¨ã‚Šã®èª¿æ•´ */
        .form-wrapper {
            padding: 0;   /* ä½™ç™½ã‚’å®Œå…¨ã«ã‚¼ãƒ­ã«ã™ã‚‹ */
            width: 100%;
        }
        
        .form-wrapper iframe { 
            width: 100%; 
            height: 800px; 
            border: none; 
        }
    </style>
</head>
<body>

<div class="container">
    <a href="navi.html" class="back-link">â† ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
    <h1>ğŸ“– ãƒ˜ãƒ«ãƒ—ï¼†è¨­å®šã‚¬ã‚¤ãƒ‰</h1>

    <details open>
        <summary>ğŸ“± ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹ãƒ»ãƒ‡ãƒ¼ã‚¿ä¿å­˜</summary>
        <div class="content">
            <h3>åŸºæœ¬æ“ä½œ</h3>
            <ul>
                <li><strong>ç¾å ´ã®ç™»éŒ²:</strong> å³ä¸‹ã®ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æ–°è¦ç™»éŒ²ã§ãã¾ã™ã€‚</li>
                <li><strong>ãƒŠãƒ“èµ·å‹•:</strong> ãƒªã‚¹ãƒˆã®ã€ŒğŸš€ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨Googleãƒãƒƒãƒ—ãŒèµ·å‹•ã—ã€åŒæ™‚ã«ãƒŠãƒ“å›æ•°ãŒã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚</li>
                <li><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´:</strong> ãƒªã‚¹ãƒˆå·¦ä¸Šã®ãƒãƒƒã‚¸ï¼ˆè¦‹ç©ä¸­ãªã©ï¼‰ã‚’è¦‹ã‚‹ã“ã¨ã§çŠ¶æ³ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ã€‚</li>
            </ul>

            <h3>â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼ˆæ¨å¥¨ï¼‰</h3>
            <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã€PCã‚„ä»–ã®ã‚¹ãƒãƒ›ã¨ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•åŒæœŸã—ã¾ã™ã€‚</p>
            <ul>
                <li><strong>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:</strong> è¨­å®šç”»é¢ã®ã€Œâ˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ã§ä¿å­˜ã—ã¾ã™ã€‚</li>
                <li><strong>å¾©å…ƒ:</strong> ã€ŒğŸ“¥ ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å¾©å…ƒã€ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ã¾ã™ã€‚</li>
                <li>â€»PCã§ç·¨é›†ã—ãŸå†…å®¹ã‚‚ã€Œå¾©å…ƒã€ãƒœã‚¿ãƒ³ã§åæ˜ ã•ã‚Œã¾ã™ã€‚</li>
            </ul>

            <h3>ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ä¿å­˜ãƒ»å¾©å…ƒï¼ˆãƒ¡ãƒ¼ãƒ«ãªã©ï¼‰</h3>
            <p>ã‚¯ãƒ©ã‚¦ãƒ‰è¨­å®šãŒãªãã¦ã‚‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚„å…±æœ‰ãŒã§ãã¾ã™ã€‚</p>
            <ul>
                <li><strong>æ›¸ãå‡ºã—:</strong> å³ä¸‹ã®ã€Œå…±æœ‰ãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼‰ã€ã‚’æŠ¼ã—ã€ã€Œå…±æœ‰ã€ã‚’é¸ã¶ã¨ã€ãƒ¡ãƒ¼ãƒ«ã‚„LINEã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.jsonï¼‰ã‚’é€ä¿¡ãƒ»ä¿å­˜ã§ãã¾ã™ã€‚</li>
                <li><strong>å–ã‚Šè¾¼ã¿:</strong> è¨­å®šç”»é¢ï¼ˆâš™ï¸ï¼‰ã®ã€ŒğŸ“¥ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©å…ƒã€ã‚’æŠ¼ã—ã€ãƒ¡ãƒ¼ãƒ«ç­‰ã§å—ã‘å–ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨å¾©å…ƒã•ã‚Œã¾ã™ã€‚</li>
            </ul>
        </div>
    </details>

    <details>
        <summary>ğŸ“ æ—¥å ±ãƒ»ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½</summary>
        <div class="content">
            <h3>æ—¥å ±ã®é€ä¿¡</h3>
            <p>ç¾å ´ãƒªã‚¹ãƒˆã®ã€ŒğŸ§° ãƒ„ãƒ¼ãƒ«ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æ—¥å ±ç”»é¢ã¸ç§»å‹•ã§ãã¾ã™ã€‚</p>
            <ul>
                <li><strong>æ—¥å ±ä½œæˆ:</strong> ãã®æ—¥ã®ä½œæ¥­å†…å®¹ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚å±¥æ­´ã¨ã—ã¦ç«¯æœ«ã«æ®‹ã‚Šã¾ã™ã€‚</li>
                <li><strong>ã‚¯ãƒ©ã‚¦ãƒ‰æå‡º:</strong> ã€ŒğŸ“¤ ã‚¯ãƒ©ã‚¦ãƒ‰ã¸æå‡ºã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œæ—¥å ±ã€ã‚·ãƒ¼ãƒˆã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚</li>
                <li>â€»ä¸€åº¦æå‡ºã—ãŸæ—¥å ±ã‚‚ã€å±¥æ­´ã‹ã‚‰å†é€å¯èƒ½ã§ã™ã€‚</li>
            </ul>
        </div>
    </details>

    <details>
        <summary>ğŸ› ï¸ ã€åˆæœŸè¨­å®šã€‘ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã®æ§‹ç¯‰</summary>
        <div class="content">
            <p>ã“ã®ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»å…±æœ‰ã™ã‚‹ãŸã‚ã®ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€ã‚’ä½œæˆã™ã‚‹æ‰‹é †ã§ã™ã€‚<br>
            <strong>åˆã‚ã¦ä½¿ã†æ–¹</strong>ã‚„ã€<strong>ç®¡ç†è€…ã®æ–¹</strong>ã®ã¿è¡Œã£ã¦ãã ã•ã„ã€‚</p>

            <h3>STEP 1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæº–å‚™</h3>
            <ol>
                <li><a href="https://sheets.new" target="_blank">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</a> ã‚’æ–°è¦ä½œæˆã—ã¾ã™ã€‚</li>
                <li>ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã€Œè·äººã‚®ã‚¢_ãƒ‡ãƒ¼ã‚¿ã€ç­‰ã«å¤‰æ›´ã—ã¾ã™ã€‚</li>
                <li>ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€â†’ã€ŒApps Scriptã€ã‚’é–‹ãã¾ã™ã€‚</li>
            </ol>

            <h3>STEP 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆç™»éŒ²</h3>
            <p>ã‚¨ãƒ‡ã‚£ã‚¿ã®æ–‡å­—ã‚’å…¨ã¦æ¶ˆã—ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
            
            <textarea id="gasCode" class="code-area" readonly>
function doPost(e) {
  var json = {};
  try {
    json = JSON.parse(e.postData.contents);
  } catch (err) {
    return createResponse({ result: "error", error: "JSON parse error" });
  }

  
  var MY_SECRET_KEY = "è¦å¤‰æ›´"; 
    if (json.authKey !== MY_SECRET_KEY) {
    return createResponse({ result: "error", error: "â›” åˆè¨€è‘‰ãŒé•ã„ã¾ã™" });
  }

  var type = json.type;
  var ss = SpreadsheetApp.getActiveSpreadsheet();

  
  if (type === "report") {
    var sheet = ss.getSheetByName("æ—¥å ±");
    if (!sheet) { 
      sheet = ss.insertSheet("æ—¥å ±"); 
      sheet.appendRow(["æ—¥æ™‚", "æ¡ˆä»¶No", "ç¾å ´å", "ä½æ‰€", "å ±å‘Šè€…", "å†…å®¹"]); 
      sheet.setFrozenRows(1); 
    }
    var reporter = json.reporter || "è·äºº";
    var reportDate = json.timestamp ? new Date(json.timestamp) : new Date();
    sheet.appendRow([reportDate, json.id, json.siteName, json.address, reporter, json.content]);
    return createResponse({ result: "success" });
  }

  
  else if (type === "sync") {
    var sheet = ss.getSheetByName("æ¡ˆä»¶ä¸€è¦§");
    if (!sheet) { sheet = ss.insertSheet("æ¡ˆä»¶ä¸€è¦§"); }

  
    var clientTime = json.clientTime || 0;
    var lastUpdateCell = sheet.getRange("Z1"); 
    var serverTime = lastUpdateCell.getValue();
    if (serverTime === "") serverTime = 0;

  
    if (serverTime > clientTime + 1000) {
       var d = new Date(serverTime).toLocaleString();
       return createResponse({ 
         result: "error", 
         error: "â›” ã‚µãƒ¼ãƒãƒ¼ã«æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿(" + d + ")ãŒã‚ã‚Šã¾ã™ã€‚\nä¿å­˜ã‚’ä¸­æ­¢ã—ã¾ã—ãŸã€‚\nå…ˆã«ã€Œå¾©å…ƒã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚" 
       });
    }

  
    var lastRow = sheet.getLastRow();
    var savedData = {}; 
    var lockedRows = {}; 

    if (lastRow > 1) {
      
      var oldValues = sheet.getRange(2, 1, lastRow - 1, 12).getValues();
      
      for (var i = 0; i < oldValues.length; i++) {
        var row = oldValues[i];
        var id = String(row[0]); // Aåˆ—: æ¡ˆä»¶No (ID)
        var price = row[10];     // Kåˆ—: è¦‹ç©é‡‘é¡
        var isLocked = row[11];  // Låˆ—: ãƒ­ãƒƒã‚¯ãƒ•ãƒ©ã‚°

        if (id) {
          
          savedData[id] = { price: price, lock: isLocked };

          
          if (isLocked === true || isLocked === "ãƒ­ãƒƒã‚¯" || isLocked === "TRUE") {
            lockedRows[id] = row;
          }
        }
      }
    }

    
    sheet.clear(); // ä¸€æ—¦ã‚¯ãƒªã‚¢

    
    var header = ["æ¡ˆä»¶No", "è¦ªæ¡ˆä»¶No", "ç¾å ´å", "ä½æ‰€", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "ãƒŠãƒ“å›æ•°", "å·¥æœŸé–‹å§‹", "å·¥æœŸçµ‚äº†", "æœ€çµ‚æ›´æ–°æ—¥æ™‚", "JSONãƒ‡ãƒ¼ã‚¿", "è¦‹ç©é‡‘é¡", "ç·¨é›†ãƒ­ãƒƒã‚¯"];
    sheet.appendRow(header);

    var sites = json.data;
    var rows = [];
    var stMap = { 'estimate':'è¦‹ç©ä¸­', 'contract':'å¥‘ç´„æ¸ˆã¿', 'billing':'è«‹æ±‚', 'complete':'å®Œäº†', 'lost':'å¤±æ³¨' };

    for (var i = 0; i < sites.length; i++) {
      var s = sites[i];
      
    
      if (lockedRows[s.id]) {
        rows.push(lockedRows[s.id]);
        continue; // æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã¸ï¼ˆã‚¹ãƒãƒ›ã®ãƒ‡ãƒ¼ã‚¿ã¯ç„¡è¦–ï¼‰
      }

    
      var savedPrice = (savedData[s.id]) ? savedData[s.id].price : "";
      var savedLock = (savedData[s.id]) ? savedData[s.id].lock : false;

    
      var stLabel = stMap[s.status] || s.status;
      rows.push([
        s.id, 
        s.parentCaseNo||"", 
        s.name, 
        s.address, 
        stLabel, 
        s.naviCount||0, 
        s.start||"", 
        s.end||"", 
        s.updatedAt ? new Date(s.updatedAt).toLocaleString() : "",
        JSON.stringify(s),
        savedPrice, // Kåˆ—
        savedLock   // Låˆ—
      ]);
    }

    if (rows.length > 0) {
      sheet.getRange(2, 1, rows.length, rows[0].length).setValues(rows);
    }
    

    sheet.getRange("Z1").setValue(Date.now());
    

    var totalRows = rows.length;
    if (totalRows > 0) {
      sheet.getRange(2, 12, totalRows, 1).insertCheckboxes();
    }

    return createResponse({ result: "success", msg: "ä¿å­˜å®Œäº†" });
  }


  else if (type === "calendar") {
    try {
      var calId = json.calendarId;
      var cal = CalendarApp.getCalendarById(calId);
      if (!cal) throw new Error("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼IDãªã—: " + calId);
      var startStr = json.start || json.startDate;
      if (!startStr) throw new Error("é–‹å§‹æ—¥ãªã—");
      var startDate = new Date(startStr);
      var endStr = json.end || json.endDate;
      var title = json.title || "ç¾å ´äºˆå®š";
      var options = { description: json.description||"", location: json.address||"" };
      
      if (endStr && endStr !== startStr) {
        var endDate = new Date(endStr);
        endDate.setDate(endDate.getDate() + 1); // çµ‚æ—¥äºˆå®šã®ä»•æ§˜å¯¾å¿œ
        cal.createAllDayEvent(title, startDate, endDate, options);
      } else {
        cal.createAllDayEvent(title, startDate, options);
      }
      return createResponse({ result: "success", message: "ç™»éŒ²å®Œäº†" });
    } catch (error) {
      return createResponse({ result: "error", error: error.toString() });
    }
  }

  return createResponse({ result: "error", error: "ä¸æ˜ãªã‚¿ã‚¤ãƒ—: " + type });
}

function createResponse(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}

function doGet(e) {

  var MY_SECRET_KEY = "è¦å¤‰æ›´"; 
  

  if (!e.parameter.authKey || e.parameter.authKey !== MY_SECRET_KEY) {
    return createResponse({ result: "error", error: "â›” åˆè¨€è‘‰ãŒé•ã„ã¾ã™" });
  }

  var type = e.parameter.type;
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  
  if (type === "getAll") {
    var sheet = ss.getSheetByName("æ¡ˆä»¶ä¸€è¦§");
    if (!sheet) return createResponse([]);


    var serverTime = sheet.getRange("Z1").getValue();

    if (!serverTime) serverTime = Date.now();
    else serverTime = new Date(serverTime).getTime(); 

    var rows = sheet.getDataRange().getValues();
    var data = [];
    var reverseStMap = { 'è¦‹ç©ä¸­':'estimate', 'å¥‘ç´„æ¸ˆã¿':'contract', 'è«‹æ±‚':'billing', 'å®Œäº†':'complete', 'å¤±æ³¨':'lost' };
    
    for (var i = 1; i < rows.length; i++) {
      var row = rows[i];

      var rawJson = row[9];
      var siteData = null;
      
      if (rawJson && rawJson.startsWith("{")) {
        try { siteData = JSON.parse(rawJson); } catch(e){}
      }
      
      if (!siteData) {
        siteData = {
          id: String(row[0]), 
          parentCaseNo: String(row[1]),
          name: String(row[2]), 
          address: String(row[3]), 
          status: reverseStMap[row[4]] || 'estimate', 
          naviCount: Number(row[5]), 
          start: row[6] ? formatYMD(row[6]) : "", 
          end: row[7] ? formatYMD(row[7]) : "", 
          updatedAt: row[8] ? new Date(row[8]).getTime() : 0 
        };
      }
      if(siteData.id) { data.push(siteData); }
    }


    var responseData = {
      serverTime: Number(serverTime), 
      items: data
    };
    
    return createResponse(responseData);
  }
  
  return createResponse({msg:"OK_YOSHI"});
}


function formatYMD(val) {
  if (!val) return "";
  var d = new Date(val);
  if (isNaN(d.getTime())) return "";
  var y = d.getFullYear();
  var m = ("0" + (d.getMonth() + 1)).slice(-2);
  var da = ("0" + d.getDate()).slice(-2);
  return y + "-" + m + "-" + da;
}

function onEdit(e) {
  var sheet = e.source.getActiveSheet();
  if (sheet.getName() !== "æ¡ˆä»¶ä¸€è¦§") return;
  var row = e.range.getRow();
  var col = e.range.getColumn();
  if (row < 2 || col === 9) return;


  sheet.getRange(row, 9).setValue(new Date());


  sheet.getRange("Z1").setValue(Date.now());
}
            </textarea>
            <button class="btn-copy" onclick="copyCode()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>

            <h3>STEP 3. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆé‡è¦ï¼‰</h3>
            <ul>
                <li>å³ä¸Šã®ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€</li>
                <li>ç¨®é¡ï¼šã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€</li>
                <li>ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼š<span style="color:red; font-weight:bold;">å…¨å“¡ (Anyone)</span></li>
            </ul>
            
            <div class="alert-box">
                <strong>âš ï¸ é‡è¦ï¼šè­¦å‘Šç”»é¢ãŒå‡ºãŸå ´åˆ</strong><br>
                åˆå›ã¯ã€Œã“ã®ã‚¢ãƒ—ãƒªã¯Googleã«ã‚ˆã£ã¦ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¾ã™ã€‚<br>
                ã“ã‚Œã¯è‡ªä½œã‚¢ãƒ—ãƒªã§ã¯å¿…ãšå‡ºã‚‹ã‚‚ã®ã§ã™ã€‚ã‚¦ã‚¤ãƒ«ã‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                <br>
                1. å·¦ä¸‹ã® <strong>ã€Œè©³ç´° (Advanced)ã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                2. ä¸€ç•ªä¸‹ã® <strong>ã€Œ...ï¼ˆå®‰å…¨ã§ã¯ãªã„ãƒšãƒ¼ã‚¸ï¼‰ã«ç§»å‹•ã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                3. <strong>ã€Œè¨±å¯ (Allow)ã€</strong> ã‚’æŠ¼ã—ã¦å®Œäº†ã•ã›ã¦ãã ã•ã„ã€‚
            </div>

            <p>æœ€å¾Œã«ç™ºè¡Œã•ã‚ŒãŸURLã‚’ã‚³ãƒ”ãƒ¼ã—ã€ã‚¢ãƒ—ãƒªã®ã€Œè¨­å®šã€â†’ã€ŒGAS URLã€ã«ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </details>

    <div class="contact-area">
        <h3>ãŠå•ã„åˆã‚ã›ãƒ»ã”è¦æœ›</h3>
        <div class="contact-msg">
            ã„ã¤ã‚‚ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼<br>
            å€‹äººã§é–‹ç™ºã—ã¦ã„ã‚‹ãŸã‚ã€è‡³ã‚‰ãªã„ç‚¹ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚<br>
            ä¸å…·åˆã®å ±å‘Šã‚„ã€Œã‚‚ã£ã¨ã“ã†ã—ãŸã„ï¼ã€ã¨ã„ã†ã”è¦æœ›ã€<br>
            ãŸã ã®å¿œæ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚‚ã€ãŠæ°—è»½ã«é€ã£ã¦ãã ã•ã„ã€‚<br>
            ä½œæ¥­ã®åˆé–“ã«å¿…ãšç›®ã‚’é€šã—ã¾ã™ï¼
        </div>
        <div class="form-wrapper">
            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfTEXqdYaOBYAPA3OzvPc2DVV5cLqjy4INWZNd0XbxHR57m6g/viewform?embedded=true" marginheight="0" marginwidth="0">èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™â€¦</iframe>
        </div>
    </div>

    <br>
    <a href="navi.html" class="back-link" style="text-align:center;">ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
</div>

<script>
    function copyCode() {
        var copyText = document.getElementById("gasCode");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(function() {
            alert("âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        }, function() {
            alert("ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
        });
    }
</script>

</body>
</html>